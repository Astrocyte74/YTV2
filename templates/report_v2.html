<!doctype html>
<html lang="en" dir="auto">
<head>
  <meta charset="utf-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, viewport-fit=cover"
  />
  <title>{{ title }} ‚Äì YTV2</title>

  <!-- Tailwind CDN (safe for initial rollout) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    // optional: small token nudge for better dark contrast
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            chip: {
              DEFAULT: '#eef2f7',
              dark: '#1f2430'
            },
            chipBorder: {
              DEFAULT: '#e5e9f2',
              dark: '#30384a'
            }
          }
        }
      },
      darkMode: 'media'
    }
  </script>

  <style>
    /* iOS safe-area for sticky player */
    .safe-bottom {
      bottom: calc(env(safe-area-inset-bottom, 0px) + 12px);
    }
    /* improve iOS slider thumb tap area a bit */
    input[type="range"]::-webkit-slider-thumb { height: 28px; width: 28px; }
  </style>
</head>
<body class="bg-white text-slate-900 dark:bg-slate-950 dark:text-slate-100">

  <!-- Top bar -->
  <header class="sticky top-0 z-50 border-b border-slate-200/70 bg-white/80 backdrop-blur dark:border-slate-800/70 dark:bg-slate-950/70">
    <div class="mx-auto flex h-14 max-w-[1100px] items-center justify-between px-4 lg:px-8">
      <a href="{{ back_url or '/' }}" class="inline-flex items-center gap-2 rounded-xl border px-3 py-1.5 text-sm font-medium transition-colors
         border-slate-200 bg-white hover:bg-slate-50 dark:border-slate-800 dark:bg-slate-900 dark:hover:bg-slate-800">
        <svg class="size-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
        </svg>
        Dashboard
      </a>
      <div class="flex items-center gap-2">
        <a href="{{ youtube_url }}" target="_blank" rel="noopener"
           class="inline-flex items-center gap-2 rounded-xl border px-3 py-1.5 text-sm font-medium transition-colors border-slate-200 bg-white hover:bg-slate-50 dark:border-slate-800 dark:bg-slate-900 dark:hover:bg-slate-800">
          <svg class="size-4" fill="currentColor" viewBox="0 0 24 24">
            <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
          </svg>
          YouTube
        </a>
        <button id="copyLinkBtn"
           class="inline-flex items-center gap-2 rounded-xl border px-3 py-1.5 text-sm font-medium transition-colors border-slate-200 bg-white hover:bg-slate-50 dark:border-slate-800 dark:bg-slate-900 dark:hover:bg-slate-800">
          <svg class="size-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
          </svg>
          Copy link
        </button>
      </div>
    </div>
  </header>

  <!-- Page container -->
  <main class="mx-auto max-w-[1100px] space-y-4 px-4 py-4 lg:space-y-6 lg:px-8 lg:py-8">

    <!-- Header grid -->
    <section class="grid grid-cols-1 items-start gap-4 lg:grid-cols-[minmax(0,600px)_1fr] lg:gap-6">
      <!-- Hero -->
      <div class="aspect-video overflow-hidden rounded-2xl border border-slate-200 bg-slate-100 dark:border-slate-800 dark:bg-slate-900/50">
        {% if thumbnail %}
          <img src="{{ thumbnail }}" alt="" class="h-full w-full object-cover" />
        {% endif %}
      </div>

      <!-- Meta + player -->
      <div class="min-w-0">
        <h1 class="mb-3 line-clamp-3 text-2xl font-bold leading-tight sm:text-3xl">
          {{ title }}
        </h1>

        <!-- compact info grid -->
        <div class="rounded-lg border border-slate-200 bg-slate-50/50 p-3 dark:border-slate-800 dark:bg-slate-900/50">
          <div class="grid grid-cols-1 gap-2 text-sm lg:grid-cols-2">
            <div class="flex items-center gap-2">
              <span class="text-slate-400">üì∫</span>
              <span class="text-slate-600 dark:text-slate-400">Channel</span>
              <span class="font-medium text-slate-900 dark:text-slate-100">{{ channel }}</span>
            </div>
            {% if duration_str %}
            <div class="flex items-center gap-2">
              <span class="text-slate-400">üïê</span>
              <span class="text-slate-600 dark:text-slate-400">Duration</span>
              <span class="font-medium text-slate-900 dark:text-slate-100">{{ duration_str }}</span>
            </div>
            {% endif %}
            {% if views_pretty %}
            <div class="flex items-center gap-2">
              <span class="text-slate-400">üëÅÔ∏è</span>
              <span class="text-slate-600 dark:text-slate-400">Views</span>
              <span class="font-medium text-slate-900 dark:text-slate-100">{{ views_pretty }}</span>
            </div>
            {% endif %}
            {% if uploaded_pretty %}
            <div class="flex items-center gap-2">
              <span class="text-slate-400">üìÖ</span>
              <span class="text-slate-600 dark:text-slate-400">Uploaded</span>
              <span class="font-medium text-slate-900 dark:text-slate-100">{{ uploaded_pretty }}</span>
            </div>
            {% endif %}
            {% if ai_model %}
            <div class="flex items-center gap-2 lg:col-span-2">
              <span class="text-slate-400">ü§ñ</span>
              <span class="text-slate-600 dark:text-slate-400">AI Model</span>
              <span class="font-medium text-slate-900 dark:text-slate-100">{{ ai_model }}</span>
            </div>
            {% endif %}
          </div>
        </div>

        <!-- compact audio player -->
        <section class="mt-3 rounded-xl border border-slate-200 bg-white p-3 dark:border-slate-800 dark:bg-slate-900">
          <div class="flex items-center gap-3">
            <button id="playPause" aria-pressed="false" aria-label="Play audio summary"
              class="grid size-10 shrink-0 place-items-center rounded-full bg-blue-600 text-sm font-semibold text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-400">
              ‚ñ∂
            </button>

            <div class="min-w-0 grow">
              <div class="flex items-center justify-between text-xs">
                <span class="font-medium text-slate-700 dark:text-slate-300">Audio summary</span>
                <span class="text-slate-500 dark:text-slate-400" id="timeMeta">0:00 / {{ audio_dur_pretty or '‚Äî' }}</span>
              </div>
              <input id="seek" type="range" min="0" max="100" value="0"
                     class="mt-1.5 h-1.5 w-full accent-blue-600" />
            </div>

            <div class="flex shrink-0 items-center gap-1.5">
              <button id="rateBtn" class="rounded-md border border-slate-200 px-2 py-1 text-xs dark:border-slate-700">1√ó</button>
              {% if audio_mp3 %}
                <a class="rounded-md border border-slate-200 px-2 py-1 text-xs dark:border-slate-700"
                   href="{{ audio_mp3 }}" download>‚Üì</a>
              {% endif %}
            </div>
          </div>

          <!-- hidden native audio (we control it) -->
          <audio id="player" preload="metadata">
            {% if audio_mp3 %}<source src="{{ audio_mp3 }}" type="audio/mpeg" />{% endif %}
          </audio>
        </section>
      </div>
    </section>

    <!-- Glossary -->
    {% if vocabulary and vocabulary|length > 0 %}
    <section class="rounded-xl border border-slate-200 bg-slate-50 p-4 dark:border-slate-800 dark:bg-slate-900/40 lg:p-5">
      <h2 class="mb-2 text-base font-semibold">üìö Vocabulary</h2>
      <dl class="grid gap-3 lg:grid-cols-2">
        {% for item in vocabulary %}
          <div>
            <dt class="font-semibold">{{ item.term }}</dt>
            <dd class="text-slate-600 dark:text-slate-300">{{ item.definition }}</dd>
          </div>
        {% endfor %}
      </dl>
    </section>
    {% endif %}

    <!-- Summary -->
    <section class="rounded-2xl border border-slate-200 bg-white p-5 dark:border-slate-800 dark:bg-slate-900 lg:p-6">
      <h2 class="mb-4 flex items-center gap-3 text-xl font-semibold">
        <div class="flex size-8 items-center justify-center rounded-lg bg-gradient-to-br from-blue-500 to-indigo-600 text-white">
          <svg class="size-5" fill="currentColor" viewBox="0 0 24 24">
            <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
          </svg>
        </div>
        <span class="text-slate-900 dark:text-slate-100">Summary</span>
      </h2>
      <article class="prose prose-lg max-w-none prose-slate dark:prose-invert">
        <div class="text-slate-700 dark:text-slate-300 leading-relaxed space-y-4">
          {{ summary_html | safe }}
        </div>
      </article>
    </section>
  </main>

  <!-- Sticky mini player (mobile & desktop) -->
  <div id="stickyBar"
       class="safe-bottom fixed left-3 right-3 z-[60] hidden rounded-xl border border-slate-200 bg-white p-3 shadow-lg dark:border-slate-800 dark:bg-slate-900 md:left-1/2 md:right-auto md:w-[600px] md:-translate-x-1/2">
    <div class="flex items-center gap-3">
      <button id="mPlayPause" aria-pressed="false" aria-label="Play audio summary"
              class="grid size-10 shrink-0 place-items-center rounded-full bg-blue-600 text-white hover:bg-blue-700">‚ñ∂</button>
      
      <div class="min-w-0 grow">
        <div class="flex items-center justify-between text-xs">
          <span class="truncate font-medium text-slate-700 dark:text-slate-300">Audio summary</span>
          <span class="text-slate-500 dark:text-slate-400" id="mTimeMeta">0:00 / {{ audio_dur_pretty or '‚Äî' }}</span>
        </div>
        <input id="mSeek" type="range" min="0" max="100" value="0"
               class="mt-1.5 h-1.5 w-full accent-blue-600" />
      </div>
      
      <div class="flex shrink-0 items-center gap-1.5">
        <button id="mRateBtn" class="rounded-md border border-slate-200 px-2 py-1 text-xs dark:border-slate-700">1√ó</button>
        {% if audio_mp3 %}
          <a class="rounded-md border border-slate-200 px-2 py-1 text-xs dark:border-slate-700"
             href="{{ audio_mp3 }}" download>‚Üì</a>
        {% endif %}
        <button id="closeSticky" aria-label="Close"
                class="rounded-md border border-slate-200 px-2 py-1 text-xs dark:border-slate-800">‚úï</button>
      </div>
    </div>
  </div>

  <script src="/static/v2/report_v2.js?v={{ cache_bust }}"></script>
</body>
</html>